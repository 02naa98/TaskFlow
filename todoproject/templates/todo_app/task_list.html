{% extends 'base.html' %}  <!-- base.html を継承 -->
{% load static %}

<title>{%block title%}TaskList{%endblock%}</title>  <!-- タイトルを上書き -->

<head>
    <link rel="stylesheet" href="{% static 'style.css' %}">
</head>

{% block content %}
    <style>
        .container {
            display: flex;
        }
        .list-filter {
            width: 20%;
        }
        .task-list {
            width: 50%; /* 左側の幅 */
        }
        .star-list {
            width: 40%; /* 右側の幅 */
        }
    </style>
    <div class='container'>
        <!-- 左側：リスト名とチェックボックス -->
        <div class='list-filter'>
            <!-- リスト作成へのリンク -->
            <a href="{%url 'list_create' %}">新しいリストを作成する</a>
            <h1>タスクリスト</h1>

            <form method='get' action=''>
                {% for list in lists %}
                <li style="display: flex; align-items: center; justify-content: space-between;">
                    <!--リストソート-->
                        <input type='checkbox' name='list_ids' value='{{ list.id }}' id='list-{{ list.id }}' >
                        <label><h6>{{ list.name }}</h6></label><!-- リスト名を表示 -->
                        
                    <div class="btn-group" > <!--デフォルト表示-->
                        <!-- リスト編集ボタン -->
                        <form action="{% url 'list_update' list.id %}">
                            {%csrf_token%}
                            <button type="submit" class="button">更新</button>
                        </form>
                        
                        <!-- リスト削除ボタン　ポップアップ&ダイヤログ -->
                        <form action="{% url 'list_delete' list.id %}" method="post" onsubmit="return confirmDeleteList();">
                            {% csrf_token %}
                            <button type="submit">削除</button>
                        </form>
                    </div>
                </li>
                {%endfor%}
                <br>
                    <!--リストソート適用ボタン-->
                    <button type='submit' class="btn btn-primary">フィルター適用</button>
                    <button onclick="clearCheckboxes()">一覧表示に戻す</button>
            </form>
        </div>

        <!-- ２列目：タスク一覧 -->
        <div class='task-list'>
                <!-- タスク作成へのリンク -->
                <a href="{%url 'task_create' %}">タスクを作成する</a>
            <h1>タスク一覧</h1>
            {% for list in lists %}
                <div class="list-container" onmouseover="showBorder(this)" onmouseout="hideBorder(this)">
                    <h2>{{ list.name }}</h2> <!-- リスト名を表示 -->
                    <ul>
                        {% for task in list.taskcreate_set.all %}
                        <li style="display: flex; align-items: center; justify-content: space-between;">
                            <span>
                                {{ task.title }} - {{ task.due_date }} - {{ task.user.username }} <!-- 表示項目 -->
                            </span>
                        <form action="{% url 'toggle_star' task.id %}" method="post" style="background: none; border: none; cursor: none;">
                            {% csrf_token %}
                            <button type="submit">
                                {% if task.is_starred %}
                                ★  <!-- スターが付いている場合 -->
                                {% else %}
                                ☆  <!-- スターが付いていない場合 -->
                                {% endif %}
                            </button>
                        <div class='btn-group'>
                            </form>
                            <!-- タスク編集ボタン -->
                            <form action="{% url 'task_update' list.id %}" method="get">
                                <button type="submit" class="btn btn-success">更新</button>
                            </form>
                            
                            <!-- タスク削除ボタン　ポップアップ&ダイヤログ -->
                            <form action="{% url 'task_delete' task.id %}" method="post" onsubmit="return confirmDeleteTask();" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-danger">削除</button>
                            </form>
                        </div>
                        </li>
                    {% empty %}
                    <li>タスクはまだ追加されていません。</li>
                    {% endfor %}
                    </ul>
                </div>
            {%endfor%}
            <script>
                //list-filter
                function showButtons(element) {
                    const buttonGroup = element.querySelector('.btn-group');
                    buttonGroup.style.display = 'flex'; // ボタンを表示
                }
                function hideButtons(element) {
                    const buttonGroup = element.querySelector('.btn-group');
                    buttonGroup.style.display = 'none'; // ボタンを非表示
                }
                
                
                //task-list
                function confirmDeleteList() {
                    return confirm("このリストを削除しますか？ このリスト上のすべてのタスクが完全に削除されます。");
                }
                function confirmDeleteTask() {
                    return confirm("本当に削除しますか？");
                }
                function showBorder(element) {
                    element.style.border = "2px solid #007bff"; // ホバー時の枠線の色
                }
                
                function hideBorder(element) {
                    element.style.border = "none"; // 元の枠線の色
                }
                //star-list
            </script>
        </div>

        <!-- 右側：スター付きタスクのみを表示 -->
         <div class="star-list">
             <h1>★スター付き</h1>
             <ul>
                 {% for task in tasks %}
                    {% if task.is_starred %}
                    <li>
                        {{ task.title }} - {{ task.user.username }} - {{ task.list.name }}
                    </li>
                    {%endif%}
                {% empty %}
                    <li>スター付きタスクはありません。</li>
                {% endfor %}
            </ul>
        </div>
{% endblock %}
